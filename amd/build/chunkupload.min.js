define ("local_chunkupload/chunkupload",["exports","jquery","core/str","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=f;b=e(b);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}var j,k;function f(a,c,d,e,f){var h=(0,b.default)("#"+a+"_file");j=e;k=f;h.change(function(){var a=h.get(0).files[0],b=".";if(-1!==a.name.indexOf(".")){var e=a.name.split(".");b=e[e.length-1]}if(!("*"===c||c instanceof Array&&-1!==c.indexOf(b))){h.val(null);i({key:"invalidfiletype",component:"core_repository",param:b});return}else if(a.size>d){h.val(null);i({key:"errorpostmaxsize",component:"core_repository"});return}g(a)})}function g(a){var c=k<a.size?k:a.size,d={start:0,end:c,length:a.size},e=a.slice(0,c),f=new XMLHttpRequest;f.open("post",j+"/local/chunkupload/startupload_ajax.php?"+b.default.param(d));f.setRequestHeader("Content-Type","application/octet-stream");f.send(e);f.onreadystatechange=function(){if(4===f.readyState){if(200===f.status){var b=JSON.parse(f.responseText);if(b.error!==void 0){i(b.error)}else{if(c<a.size){h(a,k,b.fid,b.continuetoken)}}}}}}function h(a,c,d,e){var f=c+k<a.size?c+k:a.size,g=a.slice(c,f),l=new XMLHttpRequest;l.open("post",j+"/local/chunkupload/proceedupload_ajax.php?"+b.default.param({start:c,end:f,continuetoken:e,fileid:d}));l.setRequestHeader("Content-Type","application/octet-stream");l.send(g);l.onreadystatechange=function(){if(4===l.readyState){if(200===l.status){var b=JSON.parse(l.responseText);if(b.error!==void 0){i(b.error)}else{if(f<a.size){h(a,f,d,b.continuetoken)}}}}}}function i(a){if("string"==typeof a){(0,c.get_strings)([{key:"error"},{key:"ok"}]).done(function(b){d.default.alert(b[0],a,b[1])}).fail(d.default.exception)}else{(0,c.get_strings)([{key:"error"},a,{key:"ok"}]).done(function(a){d.default.alert(a[0],a[1],a[2])}).fail(d.default.exception)}}});
//# sourceMappingURL=chunkupload.min.js.map
